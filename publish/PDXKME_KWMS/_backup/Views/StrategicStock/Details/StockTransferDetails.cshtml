@{ 
    bool isInternetExplorer = false;
    if (Request.Browser.Browsers.Contains("ie"))
    {
        isInternetExplorer = true;
        if (Request.Browser.MajorVersion < 8)
        {
        }
    }
}
@Scripts.Render("~/bundles/InquiryJSBundle")
@Styles.Render("~/Content/InquiryCSSBundle")
<script src="@Url.Content("~/Scripts/FileUpload/bootstrap-filestyle.min.js")" type="text/javascript"></script>
<style>
.accordianRows{height: 80px !important;    min-height: 80px;}    
.controlsMargin{margin: 0 -89px 0 0;} 
.modal-sm {  width: 369px;}
#ConfirmModalBody { padding: 7px 3px 9px 4px !important; }
.fileContainer {margin-right: -24px; margin-left: 2px;} 
  @@media screen and (min-width:992px) and (max-width: 1198px) 
{
.controlsMargin {margin: 0 -56px 0 0 !important;}
#txtDistributerName    { width:89% !important }
.fileContainer{margin-right: 12px; margin-left: 2px; }
.btnImport{ margin-right: 13px;} 
.btnCalculate{margin-right: 13px;}  
.btnAddParts {margin-right: 13px;} 
.btnUpdate{margin-right: 13px;}   
.btnSave {  margin-right: 13px;} 
.btnDelete{margin-right: 13px;} 
}
 @@media screen and (min-width:768px) and (max-width: 991px) 
{
.controlsMargin {margin: 0 -19px 0 0 !important;}
#txtDistributerName{ width:75% !important;   }   
.fileContainer{margin-right: -25px; margin-left: 2px;} 
.btnImport { margin-right: -25px;} 
.btnCalculate {margin-right: -25px;} 
.btnAddParts { margin-right: -25px;} 
.btnUpdate { margin-right: -25px;}  
.btnSave { margin-right: -25px; } 
.btnDelete{ margin-right: -25px; }  

}
  @@media screen and   (max-width: 767px) 
{
.controlsMargin {margin: 0 -19px 0 0 !important;}
.divErrorCheckBox{ padding: 3px 4px 3px 28px !important;}
#chkDeleteAll{  margin: 0 7px -25px -37px !important;}
.btn { margin-bottom:2px !important; width:100%    !important; }  
.StockTransferDetailsMain input[type=text]{width:97%    !important; }   
.TopMarginAtXs { margin-top:5px;  width:100% !important;  }   
.InputElements {width:97% !important;} 
}
@@media screen and (max-width: 414px)
 {
.PagingStyle {margin : 2px 0 0 97px !important; } 
.InputElements{width:100% !important; }  
}
#StockTransferDetailsGrid tr th,#StockTransferDetailsGrid tr td{white-space:nowrap; }  
label.btn-default{  color: White !important;}
.bootstrap-filestyle input[type=text]{ height:30px}
.table{ margin:0 !important;}    
</style> 

<div class="container  StockTransferDetailsMain  childcontent ">
    <div class="panel panel-primary panelWidth">
        <div class="panel-heading PanelTitle">
            <h3 class="panel-title pull-left" style="font-weight: bold; margin-right: 30px !important">
                @Resources.Resource.StockTransferRequestDetail</h3>
        </div>
        <div class="panel-body"  >
            <div class="row" style="margin:-9px 0 0 -11px;">
                <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12 controlsMargin" >
                    <button class=" btn   " id="btnSearch">
                        @Resources.Resource.btnSearch</button>
                </div>
                 <div class="col-lg-2 col-md-2 col-sm-2 col-xs-12 controlsMargin">
                    <button class=" btn   " id="btnCondition">
                        @Resources.Resource.btnCondition</button>
                </div> 
                <span id="lblMsg" style="color: Red; padding-left: 14px;"></span>
            </div>
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                    <div>
                        <label>
                            @Resources.Resource.lblTransferRequestNo
                        </label>
                    </div>
                    <div>
                        @Html.TextBox("txtTransferQuoteNo", null, new { @class = "form-control InputElements", style = "display:inline" })
                        <span id="spnQuotation"></span>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblStatus)
                    </div>
                    <div>
                        @Html.TextBox("txtStatus", null, new { disabled = "disabled", @class = "form-control InputElements" })
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblCurrency)
                    </div>
                    <div>
                        @Html.TextBox("txtCurrency", null, new { disabled = "disabled", @class = "form-control InputElements" })
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblDistributorCode)
                    </div>
                    <div>
                        @Html.TextBox("txtDistributerCode", null, new { disabled = "disabled", @class = "form-control InputElements" })
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6 col-md-3 col-sm-6 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblDistributorName)
                    </div>
                    <div>
                        @Html.TextBox("txtDistributerName", null, new { disabled = "disabled", @class = "form-control InputElements", style = "width:88%" })</div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblTransferToWareHouse)
                    </div>
                    <div>
                        @Html.TextBox("txtTransferToWarehouse", null, new { disabled = "disabled", @class = "form-control InputElements" })
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblRequestedTransferDate)
                    </div>
                    <div>
                        @Html.TextBox("txtReqTransferDate", null, new { disabled = "disabled", @class = "form-control InputElements" })
                    </div>
                </div>
            </div>
            <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12 divErrorCheckBox" style="padding-top:5px;padding-left: 29px;">
        <label  >
                                <input type="checkbox"  style="margin: 0px 5px -25px -16px  ; width: inherit;" name="chkSelectAll" id="chkSelectAll" class="form-control InputElements"  ><input type="hidden" value="false" name="cbxUnprocess">
                                @Resources.Resource.lblSelectAll</label>
                 </div>
            </div>
        </div>
    </div>
</div>
<div class="container childcontent " style="padding-top: 0px ! important;">
    <div class="panel panelInquiryControls panel-primary panelWidth">
        <div class="row controlsGroup" style="padding: 6px 0px 0px ! important;">
            <div class="col-lg-2 col-md-1 col-sm-2 col-xs-12 fileContainer">
                @if (isInternetExplorer)
                {
                    <form id="frmIEUpload"  enctype="multipart/form-data"  method="post"  >
                    <input type="file" id="fuUploadCSV" style="display:none" class="filestyle" name="fuUploadCSV" data-buttontext="Browse" />
                    </form>
                }
                else
                {
                    <input type="file" id="fuUploadCSV" class="filestyle" style="display:none" data-buttontext="Browse" />
                }
            </div>
            <div class="col-lg-1 col-md-1 col-sm-2 col-xs-12 btnImport">
                <button class="btn btn-sm btn-primary custom btnMargin" id="btnImport">
                    Import</button>
            </div>
            <div class="col-lg-1 col-md-1 col-sm-2 col-xs-12 btnAddParts">
                <button class="btn btn-sm btn-primary custom btnMargin" id="btnAddParts">
                    Add Parts</button>
            </div>
            <div class="col-lg-1 col-md-1 col-sm-2 col-xs-12 btnCalculate">
                <button class="btn btn-sm btn-primary custom btnMargin" id="btnCalculate">
                    @Resources.Resource.btnCalculate</button>
            </div>
            <div class="col-lg-1 col-md-1 col-sm-2 col-xs-12 btnSave">
                <button class="btn btn-sm btn-primary custom btnMargin" id="btnSave">
                    @Resources.Resource.btnSave</button>
            </div>
            <div class="col-lg-1 col-md-1 col-sm-2 col-xs-12 btnDelete">
                <button class="btn btn-sm btn-primary custom btnMargin" id="btnDelete" disabled="disabled" data-target="#myModal">
                    @Resources.Resource.btnDelete</button>
            </div>
        </div>
        <div id="divParts" style="height: 388px; overflow: scroll">
        </div>
        <div id="outer" style="margin-left: 10px; margin-top: 9px; margin-bottom: 5px;">
            <div class="row">
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblTotalPriceAmount)
                    </div>
                    <div>
                        @Html.TextBox("txtTotalPriceAmount", "0", new { style = "text-align:right", disabled = "disabled", @class = "form-control  InputElements " })</div>
                </div>
                @*Price Amount*@
                <div class="col-lg-2 col-md-3 col-sm-4 col-xs-12">
                    <div>
                        @Html.Label(@Resources.Resource.lblTotalWeight)
                    </div>
                    <div>
                        @Html.TextBox("txtTotalWeight", "0", null, new { style = "text-align:right", disabled = "disabled", @class = "form-control InputElements " })</div>
                </div>
                @*Total Weight *@
            </div>
        </div>
        <div class="lagends accordion hideonLoad "  style="display:none">
            <a href="#">@Resources.Resource.Legends <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-e">
            </span></a> 
                 <div class="accordianRows"  >   
                  <div class=" row">
                <div class=" legColumn col-lg-1 col-md-1  col-sm-6 col-xs-6 ">
                   <label>@Resources.Resource.thLineNo:
                    </label>
                </div>
                <div class=" legDescColumn col-lg-3 col-md-3  col-sm-6 col-xs-6 ">
                   <label>@Resources.Resource.LineNoDesc
                          </label>
                </div>
                <div class=" legColumn col-lg-1 col-md-1  col-sm-6 col-xs-6 ">
                    <label>@Resources.Resource.thSubLineNo:
                       </label>
                </div>
                <div class=" legDescColumn col-lg-2 col-md-3  col-sm-6 col-xs-6 ">
                    <label>@Resources.Resource.SubLineNoDesc</label>
                </div>
                                <div class=" legColumn col-lg-1 col-md-1 col-sm-6 col-xs-6 ">
                    <label>   AQ:
                    </label>
                </div>
                <div class=" legDescColumn col-lg-2 col-md-3  col-sm-6 col-xs-6 ">
                    <label>  @Resources.Resource.AcceptedQuantityDesc</label>
                </div>
            </div>
</div>
</div>
    </div>
</div>
<div class="modals">
    <!-- Modal -->
    <div class="modal fade" id="ErrorModal" role="dialog" style="padding-top: 169px;">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;</button>
                    <h4 class="modal-title">
                         @Resources.Resource.StockTransferRequestDetail
                    </h4>
                </div>
                <div class="modal-body" id="divModalBody">
                    <span id="lblMessage"></span>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>
</div>
@* Model Dialoge *@
<div class="modals">
    <!-- Modal -->
    <div class="modal fade" id="ConfirmModal" role="dialog" style="padding-top: 169px;">
        <div class="modal-dialog modal-sm">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;</button>
                    <h4 class="modal-title">
                       @Resources.Resource.Delete</h4>
                </div>
                <div class="modal-body" id="ConfirmModalBody">
                <img  src="@Url.Content("~/images/question.png")" />
                   @* <label style="color: Red !important">
                        Are you sure you want to delete selected part?</label>*@
                         <label style="color: Red !important">
                       @Resources.Resource.MsgInfo20</label>
                </div>
                <div class="modal-footer">
                    <button id="btnOkDelete" class="btn btn-default pull-left" data-dismiss="modal">
                        @Resources.Resource.btnOK</button>
                    <button id="btnCancleDelete" class="btn btn-default pull-right" data-dismiss="modal">
                        @Resources.Resource.btnCancel</button>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modals">
    <!-- Modal -->
    <div class="modal fade" id="MessageModal" role="dialog" style="padding-top: 169px;">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        &times;</button>
                    <h4 class="modal-title">
                   @Resources.Resource.StockTransferRequestInquiry</h4>
                </div>
                <div class="modal-body" id="modalBody">
                <img  class="imgError"/>
                <label id="lblMessageText"  class="lblError"></label>
                </div>
                <div class="modal-footer">
                 <button style=" text-align:center;float: none !important;" id="btnOk" class="btn btn-default center-block" data-dismiss="modal">
                     @Resources.Resource.btnOK
                  </button>
                </div>
            </div>
        </div>
    </div>
</div>
@* Confirm Dialoge *@
<div class="hiddenForm" style="display: none !important;">
    <form method="post" action="@Url.Action("DownloadFile", "QuotationDetails", null)" >
    </form>
</div>

<style>
#StockTransferDetailsGrid thead tr th{ text-align:left;}
 .a_ProcessedPartNo{ margin-right:2px !important}
 .header_LineNo{ text-align:right !important}
 .header_SubLine_No{ text-align:right !important}
 .header_AcceptedQty{text-align:right !important}
 .header_UnitPrice{text-align:right !important}
 .header_PriceAmt{text-align:right !important}
 .header_Weight{text-align:right !important}
</style>
@* Hidden Form.Purpose is to Triggger a Full PostBack in case it is Necessary  *@
<script type="text/javascript">
    var txtErrorType;
    var txtError;
    var DBCode;
$(document).ready(function ()
    {
    $(".lagends").removeAttr("style");
     $(".accordion").accordion({autoHeight:true,
            collapsible: true,
            active: false
        });
      $(".hideonLoad").hide();
      $(".bootstrap-filestyle input[type=text]").addClass("hidden-sm hidden-md ");
   AppendNewRow();
    $("#divParts").parent("div").prepend("<div id='divLoading'></div>"); 
    $("#btnDelete").attr("disabled", true);    
      var fileUploadViaIE="@ViewBag.ieFileUpload"
        if(fileUploadViaIE=="True")
        {
         $("#txtTransferQuoteNo").val(GetParameterValues('QuoteNo'));
        }
        else
        {        
        var quotationNo = GetParameterValues('QuoteNo');
         DBCode=GetParameterValues('DBCode');
        if (quotationNo != null && quotationNo != "") {
        $("#txtTransferQuoteNo").val(quotationNo);
        Search(quotationNo);
        }
         }
     DisableControls();
});
$(document).on("click", "#btnSearch", function () {
if( !PostGetPreCheck()){return;}//This Check makes sure that there is not any exsiting Ajax Request ,in other case the call is returned void and doesnt proceeds to next code
    if ($("#txtTransferQuoteNo").val() == "") {
       /*$("#spnQuotation").html("*").attr("style", "color:red");*/
        $("#txtTransferQuoteNo").attr("style","border-color:#ff8080 !important;box-shadow: 0px 0px 5px 0px #ff8080;display: inline");
        //$("#lblMessage").html("Please Enter Transfer Request No").attr("style", "color:red");
       /* $("#lblMessage").html("@Resources.Resource.MsgInfo51").attr("style", "color:red");
        $("#ErrorModal").modal();*/
        txtError ="@Resources.Resource.MsgInfo51";
        txtErrorType = "0";
        DisplayModal(txtErrorType, txtError); 
        return;
    }
    /*$("#spnQuotation").html("");*/
    $("#txtTransferQuoteNo").attr("style","");
    Search($("#txtTransferQuoteNo").val());

    //Shabbir Start
    if(status == "0")
    {
        RemoveItemsForSelectAll();
        $("#btnDelete").attr("disabled",true);
        $("#chkSelectAll").prop("checked",false);
    }
    //Shabbir End
});
///this Event Makes Clicked Row Higlighted untill another row is clicked

var gselectedList = [];//Shabbir
$(document).on("click", '#StockTransferDetailsGrid> tbody>tr', function () {
    if(!$(this).hasClass("trBtnAddNewParts")&& !$(this).hasClass("NewPartsRow") )//make sure not to perform highlighting on New Parts Add row
      {
      //Shabbir commented below code
//        var countHighlightedRows=0;
//		
//			var state = $(this).hasClass('highlight')  ;
//			if (!state)
//			 {
//				$(this).addClass('highlight');				 
//			 
//			  } else{$(this).removeClass('highlight');}
//              $('.highlight').each(function () {
//			countHighlightedRows+=1;
//		     });             
//            
//              if(countHighlightedRows>0 && status=="0")
//              {
//              
//              $("#btnDelete").removeAttr("disabled" );
//              }
//              else
//              {  
//            
//              $("#btnDelete").attr("disabled",true);
//              }
//            } 
//  Shabbir Commented above code

            if(status=="0")
            {
              //To highlight/un highlight the rows and move or remove them from array
              var state = $(this).hasClass('highlight')  ;
			    if (!state)
			    {
				    $(this).addClass('highlight');	
                     
                    if (!isItemInArray(gselectedList, [$.trim($(this).children("td").eq(0).text()),$.trim($(this).children("td").eq(1).text())])) 
                    {
                        gselectedList.push([$.trim($(this).children("td").eq(0).text()),$.trim($(this).children("td").eq(1).text())]);
                    }
			    } 
                else
                {
                    $(this).removeClass('highlight');
                    
                    if (isItemInArray(gselectedList, [$.trim($(this).children("td").eq(0).text()),$.trim($(this).children("td").eq(1).text())])) 
                    {
                        RemoveUnSelected($.trim($(this).children("td").eq(0).text()),$.trim($(this).children("td").eq(1).text()));
                    }
                }

                //To Check/UnCheck Check-All checkbox
                if(gselectedList.length == parseInt(totalPartsCount))
                {
                    $("#chkSelectAll").prop("checked",true);
                }
                else
                {
                    $("#chkSelectAll").prop("checked",false);
                }

                //To enable or disable Delete button
                if(gselectedList.length > 0)
                {
                     $("#btnDelete").attr("disabled",false);
                }
                else
                {
                     $("#btnDelete").attr("disabled",true);
                }
                
              }
            }
   
});
 
//Shabbir Start
function isItemInArray(gselectedList, item) 
{
    for (var i = 0; i < gselectedList.length; i++) {
        if (gselectedList[i][0] == item[0] && gselectedList[i][1] == item[1]) {
            return true;
        }
    }
    return false;
}

function RemoveUnSelected(lineno,sublineno) {
    for (i=0; i<gselectedList.length; i++){
            //var lineno = gselectedList[i][0];
            //var sublineno = gselectedList[i][1];
            if (gselectedList[i][0] === lineno && gselectedList[i][1] === sublineno)
            {
                gselectedList.splice(i--,1);
            }
        }
 }
 //Shabbir End

 $(document).on('keydown paste', '#txtTransferQuoteNo', function (e) { if(this.value.length>= 10 && e.keyCode!=8 ) {   e.preventDefault();return false; } -1 !== $.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) || /65|67|86|88/.test(e.keyCode) && (!0 === e.ctrlKey || !0 === e.metaKey) || 35 <= e.keyCode && 40 >= e.keyCode || (e.shiftKey || 48 > e.keyCode || 57 < e.keyCode) && (96 > e.keyCode || 105 < e.keyCode) && e.preventDefault() });
   $( "#txtTransferQuoteNo" ).on("paste", function(event) {setTimeout( function() {   if( !$.isNumeric(  $( "#txtTransferQuoteNo" ).val().trim() ) ){ $( "#txtTransferQuoteNo" ).val(""); false;}         }, 1); });
///this Event Appends A new row with Input elements when TAB key is pressed while the Transfer Quantity Texbox is highlighted
$(document).on("keypress", ".addQuantityinGrid", function (e) {
    if (e.which == 13 || e.keyCode == 9) { 
        e.stopPropagation();
        var val = $(this).closest('tr');
        val.after("<tr class='NewPartsRow'>  <td> </td><td> </td>  <td><input type='text' class='addPartsinGrid'/><span></span></td><td> </td>  <td></td> <td><input type='text' class='addQuantityinGrid' /> <span></span>   </td> <td></td>   <td></td>   <td>   </td>     <td> </td> <td> </td>  </tr>");
        if (e.keyCode == 9) { val.next("tr").find(".addPartsinGrid").focus(); e.preventDefault(); } else { val.next("tr").find(".addPartsinGrid").focus(); }
    }
});
  $(document).on("focusout", ".addPartsinGrid ,.addQuantityinGrid, .addUnitPrice ,.addDiscountPerItem", function () {
        if ($(this).hasClass("addUnitPrice") || $(this).hasClass("addDiscountPerItem")) {
        }
        else {
            if ($.trim($(this).val()) == "") {
                $(this).next("span").html("*").attr("style", "color:red;")
            }
            else {
                $(this).next("span").html("");
            }
        }
    });
 $("#btnAddParts").click(function () {
        var newPartsFromUser = [];
        $(".NewPartsRow").each(function () {                
        var currRow=$(this); 
        var reqPartNo= currRow.find(".addPartsinGrid").val();
        var reqQuantity= currRow.find(".addQuantityinGrid").val(); 
          if(reqPartNo==""){currRow.find(".addPartsinGrid").next("span").html("*").attr("style","color:red"); }
                 if( reqQuantity==""){currRow.find(".addQuantityinGrid").next("span").html("*").attr("style","color:red");} 
        if(reqPartNo!="" && reqQuantity!="" && reqQuantity!="0" )
        {         
        newPartsFromUser.push({RequestedPartNo:reqPartNo,TransferQty:reqQuantity  });                            
         }
          });
        if(newPartsFromUser.length==0){return;}
        $.post("@Url.Action("AddNewParts", "STDetails", null)", {strNewParts:JSON.stringify(newPartsFromUser)},
        function (PartsDetails) 
        {   
            if (CheckForSessionExpiry(PartsDetails)) 
                    {
                    SessionExpiredRedirect();
                    return;
                    }
                 if(CheckForServerSideError(PartsDetails))
                 {
                    $(".hiddenForm").html(PartsDetails);                         
                    $("#ErrorModal").modal();
                 }              
                 else
                 { 
                     var PartsDetails=PartsDetails.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
                     var PartsDetails=PartsDetails.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if(  !($(this).parent('li').hasClass('disabled')) && !($(this).parent('li').hasClass('active')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
                    $('#divParts').html(PartsDetails);    
                  }               
        });      ///End Post
    });
$('#btnDelete').click(function () 
{   
     $("#ConfirmModal").modal();       
});///End btnDelete Click  
 $(document).on("click", "#btnCalculate", function () {
  Calculate();
   });
 $(document).on("click", "#btnSave", function () {
  UpdateDetails();
   });
   $('#btnOkDelete').click(function () 
  {  
  $("body").css("padding-right", "0px");
  $("#ConfirmModal").modal('hide');                
       PerformDeletion();              
 }); 
</script>@*Document Ready Specific Events *@ 
<script type="text/javascript">
    $(document).on('keydown', '#txtTransferRequestNo', function (e) { -1 !== $.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) || /65|67|86|88/.test(e.keyCode) && (!0 === e.ctrlKey || !0 === e.metaKey) || 35 <= e.keyCode && 40 >= e.keyCode || (e.shiftKey || 48 > e.keyCode || 57 < e.keyCode) && (96 > e.keyCode || 105 < e.keyCode) && e.preventDefault() });
    
</script>@*Events*@
<script type="text/javascript">
function AppendNewRow(){
///this Event Appends A new row with Input elements when a speciefied blank row is clicked in grid
$(document).on("click touchstart", ".trBtnAddNewParts", function () {
    $(this).before("<tr class='NewPartsRow'>  <td> </td><td> </td>  <td><input type='text' class='addPartsinGrid'/><span></span></td><td> </td>  <td></td> <td><input type='text' class='addQuantityinGrid' /> <span></span>   </td> <td></td>   <td></td>   <td>   </td>     <td> </td> <td> </td>  </tr>");
    $(this).prev("tr").find(".addPartsinGrid").focus();
    if (CurrentRole != "1") {
        $(".addUnitPrice").hide();
        $(".addDiscountPerItem").hide();
    } else {
        $(".addUnitPrice").show();
        $(".addDiscountPerItem").show();
    }
});
}
var status;
var CurrentRole;
function Search(quotationNo) {
    var formData = { txtTransferQuoteNo:quotationNo,DBCode:DBCode };  
    $.post("@Url.Action("Search", "STDetails", null)",formData,function (searchResult) 
    {
    if (CheckForSessionExpiry(searchResult)) 
        {
        SessionExpiredRedirect();
        return;
        }
    else
    {
        var searchResult=searchResult.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
        var searchResult=searchResult.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if(  !($(this).parent('li').hasClass('disabled')) && !($(this).parent('li').hasClass('active')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
     $("#divParts").html(searchResult);   
     $(".hideonLoad").show(); 
     }      
      });    
    }
    function Calculate()
    {      
    $.post("@Url.Action("Calculate", "STDetails", null)",null,function (searchResult) 
    {
             if (CheckForSessionExpiry(searchResult)) 
                    {
                    SessionExpiredRedirect();
                    return;
                    }
    else
    {
        if(CheckForServerSideError(searchResult))
             {
                $(".hiddenForm").html(searchResult);                         
                $("#ErrorModal").modal();
             } 
             else
             {   
                var searchResult=searchResult.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
                var searchResult=searchResult.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if(  !($(this).parent('li').hasClass('disabled')) && !($(this).parent('li').hasClass('active')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
                $("#divParts").html(searchResult);   
             }    
     }           
      });        
    }
function GetParameterValues(param)
{
    var url = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for (var i = 0; i < url.length; i++) {
        var urlparam = url[i].split('=');
        if (urlparam[0] == param) {
            return urlparam[1];
        }
    }
}
  
function AfterLoad()
{
   $(".gridHead th a").each(function(){
  $(this).addClass( "a_"+ $(this).attr("href").split("sort=")[1].split("&")[0]) ;

   $(this).parent("th").addClass( "header_"+ $(this).attr("href").split("sort=")[1].split("&")[0]) ;
});
    if (status=="0") 
    {
     $("#StockTransferDetailsGrid>tbody").append("<tr class='trBtnAddNewParts'><td>&nbsp</td><td> </td><td> </td>   <td> </td><td></td><td></td><td></td><td></td><td></td><td></td><td></td> </tr>");
  //  $('#chkSelectAll').removeAttr("disabled");//hst006
    }else
    {
     //$('#chkSelectAll').attr("disabled",true);//hst006//Shabbir
    $(".group-span-filestyle").attr("disabled",true);
    }
    $('.NewPaging ul').addClass("pagination");

      //Shabbir Start
      //$( "#chkSelectAll").prop('checked', false);//hstA02//Shabbir

      if(gselectedList.length != "0" && gselectedList.length == parseInt(totalPartsCount))
       {
         $("#chkSelectAll").prop("checked",true);
         $("#StockTransferDetailsGrid>tbody>tr").each(function(){
            if($.trim($(this).children("td").eq(0).text()) != "")
                {$(this).addClass('highlight');}
         });
       }
       else
       {
         $("#chkSelectAll").prop("checked",false);

         $("#StockTransferDetailsGrid>tbody>tr").each(function(){
            $(this).removeClass('highlight');
            if(isItemInArray(gselectedList, [$.trim($(this).children("td").eq(0).text()),$.trim($(this).children("td").eq(1).text())]))
            {
                $(this).addClass('highlight');
            }
         });
       }
       
       //Shabbir End
    $('a[data-swhglnk="true"]').attr('href', function () 
    {
    ///Change to index 5 when running on Localhost IIIS
    //Or Change to Index 4 on default Development Server
    var correctURL = this.href.split('/')[5].split('?')[0];         
    return this.href.replace(correctURL, 'Search');
    });      
setArrowImages();
}
 function setArrowImages() {
        var dir = $('#dir').val();
        var col = $('#col').val();
        var header = $('th a[href*=' + col + ']');
        if (dir == 'Ascending') 
        {
            header.text(header.text() + ' ▲');
        }
        if (dir == 'Descending') 
        {
            header.text(header.text() + ' ▼');
        }
    } 
function UpdateDetails()
{
var postData={txtTransferQuoteNo:$("#txtTransferQuoteNo").val()};
 $.post("@Url.Action("Save", "STDetails", null)",postData,function (searchResult) 
    {
             if (CheckForSessionExpiry(searchResult)) 
                    {
                    SessionExpiredRedirect();
                    return;
                    }
    else
    {
          if(CheckForServerSideError(searchResult))
             {
                $(".hiddenForm").html(searchResult);                         
                $("#ErrorModal").modal();
             }              
             else
             {   
                var searchResult=searchResult.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
                var searchResult=searchResult.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if( !($(this).parent('li').hasClass('disabled')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
                $("#divParts").html(searchResult);    
              }   
     }           
      });    

      //Shabbir Start
      RemoveItemsForSelectAll();
        $("#btnDelete").attr("disabled",true);
        $("#chkSelectAll").prop("checked",false);
        //Shabbir End
}
function PerformDeletion()
{
     var selectedRow=$(".highlight ");                   
//        var LineNo=selectedRow.children("td").eq(0).text();
//        var LineSubNo=selectedRow.children("td").eq(1).text();     
                    var partsToDelete = [];      

                    //Shabbir Start Commented below block
//                     $('.highlight').each(function (){ //hst006
//                      var selectedRow=$(this); 
//                      var LineNo=selectedRow.children("td").eq(0).text();
//                      var LineSubNo=selectedRow.children("td").eq(1).text();
//                      partsToDelete.push({LineNo:LineNo,SubLine_No:LineSubNo});
//                     });
           //Shabbir End Commented
           //Shabbir Start Update Now we will not take rows Line No and 
           //Sub Line No from highlighted rows but from array
           for(var i = 0 ; i < gselectedList.length;i++)
           {
                partsToDelete.push({LineNo:gselectedList[i][0],SubLine_No:gselectedList[i][1]});
           }
           //Shabbir End

        if ( partsToDelete.length!=0) 
        {                           
        var formData = { strPartsToDelete:JSON.stringify(partsToDelete)}; 
        $.ajax({
        type: "POST",
        data: formData,
        url:"@Url.Action("Delete", "STDetails", null, Request.Url.Scheme)",
        success: function (PartsDetails) 
        {
                 if (CheckForSessionExpiry(PartsDetails)) 
                    {
                    SessionExpiredRedirect();
                    return;
                    }
             if(CheckForServerSideError(PartsDetails))
             {
                $(".hiddenForm").html(PartsDetails);                         
                $("#ErrorModal").modal();
             } 
             else
             {          
                var PartsDetails=PartsDetails.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
                var PartsDetails=PartsDetails.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if(  !($(this).parent('li').hasClass('disabled')) && !($(this).parent('li').hasClass('active')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
                $('#divParts').html(PartsDetails);      
              //  $("#ErrorModal").modal();     
             }                    
        },
        error: function (data) 
        {                    
         // $("#lblMessage").html("An error occured while deleting part").attr("style", "color:red");
         $("#lblMessage").html("@Resources.Resource.MsgInfo25").attr("style", "color:red");
          $("#ErrorModal").modal();             
        }
        });
        }

        //Shabbir Start
        RemoveItemsForSelectAll();
        $("#btnDelete").attr("disabled",true);
        $("#chkSelectAll").prop("checked",false);
        //Shabbir End
}
function CheckForServerSideError(data)
{
    var tempData = JSON.stringify(data);
    if (tempData.indexOf("Sorry,") > -1)
    {
    return true;        
    }   
}
function DisableControls()
{
 $('.bootstrap-filestyle input[type=text]').attr("disabled", true);
$("#fuUploadCSV").attr("disabled",true);
$("#btnImport").attr("disabled",true);
$("#btnAddParts").attr("disabled",true);
$("#btnCalculate").attr("disabled",true);
$("#btnSave").attr("disabled",true);
$("#btnDelete").attr("disabled",true);
  $("#chkSelectAll").attr("disabled", true);
  $("#chkSelectAll").prop('checked', false);
}

  
 
 
</script>@*Functions*@
 
@if (isInternetExplorer)///Render Different File upload method to hande in-compatability of Async file upload issue with IE
{
    <script>
        $("#btnImport").removeAttr("disabled");
        $('#btnImport').click(function () {
         if ($('.bootstrap-filestyle input[type=text]').val().trim() == "") {
                //$("#lblMessage").html("Please select csv  file").attr("style", "color:red");
                $("#lblMessage").html("@Resources.Resource.MsgInfo52").attr("style", "color:red");
                $("#ErrorModal").modal();
                return;
            }
            var form = $('#frmIEUpload');
            form.append("<input type='hidden' name='hftxtTransferQuotationNo' id='hftxtTransferQuotationNo'  value="+ $('#txtTransferQuoteNo').val() +" >");
            form.attr("action","@Url.Action("ImportCSV", "STDetails", null, Request.Url.Scheme)");
            form.submit();
        });
    </script>  
}
else
{    
    <script>
        $("#btnImport").attr("disabled",true); 
        $('#fuUploadCSV').on("change",function (){
        var totalFiles = document.getElementById("fuUploadCSV").files.length;
         if (totalFiles.toString() == "0") 
         {
          $("#btnImport").attr("disabled","disabled");          
         }
         else
         {                             
            var ext = $(this).val().split('.').pop().toLowerCase();
            if($.inArray(ext, ['CSV','csv']) == -1) 
            {
                $("#btnImport").attr("disabled","disabled");
               // $("#lblMessage").html("invalid file Formate ").attr("style", "color:red");
                $("#lblMessage").html("@Resources.Resource.MsgInfo53").attr("style", "color:red");
                $("#ErrorModal").modal();     
            }
            else 
            {                    
            $("#btnImport").removeAttr("disabled");                    
            }
         }
});
       $('#btnImport').click(function () {
         var formData = new FormData();
         var totalFiles = document.getElementById("fuUploadCSV").files.length;
         if (totalFiles.toString() == "0") {
           //$("#lblMessage").html("Please select CSV File to upload").attr("style", "color:red");
           $("#lblMessage").html("@Resources.Resource.MsgInfo54").attr("style", "color:red");
             $("#ErrorModal").modal();           
             return false;
         }
         for (var i = 0; i < totalFiles; i++) {
             var file = document.getElementById("fuUploadCSV").files[i];
             formData.append("FileUpload", file);
         }
         $.ajax({
             type: "POST",
              url:"@Url.Action("ImportCSV", "STDetails", null, Request.Url.Scheme)",      
             data: formData,
             contentType: false,
             processData: false,
             beforeSend: function (xhr) {              
             },
             success: function (PartsDetails) 
             {
               if (CheckForSessionExpiry(PartsDetails)) 
                    {
                    SessionExpiredRedirect();
                    return;
                    }
               if(CheckForServerSideError(PartsDetails))
                 {
                    $(".hiddenForm").html(PartsDetails);                         
                    $("#ErrorModal").modal();
                 } 
                 else
                 {                  
                var PartsDetails=PartsDetails.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
                var PartsDetails=PartsDetails.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if(  !($(this).parent('li').hasClass('disabled')) && !($(this).parent('li').hasClass('active')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
                $('#divParts').html(PartsDetails);                  
                $("#fuUploadCSV").val(""); //hstA02
                $(".bootstrap-filestyle input[type=text]").val("");//hstA02
                  }  
             },
             error: function (data) {                
                //$("#lblMessage").html("An error occured while uploading file").attr("style", "color:red");
                $("#lblMessage").html("@Resources.Resource.MsgInfo55").attr("style", "color:red");
                $("#ErrorModal").modal();
             }
         })
     });
    </script>
}
@if (Session["ieFileUpload"] != null)//hst001
{
    <script>
       $.post("@Url.Action("Search", "STDetails", null)",null,function (PartsDetails) { 
                  if(CheckForServerSideError(PartsDetails))
                    {   
                        $(".hiddenForm").html(PartsDetails);      
                        $("#ErrorModal").modal();                      
                    }
                    else {
                    var PartsDetails=PartsDetails.replace("$(containerId).parent().delegate","$(containerId).parent().undelegate();$(containerId).parent().delegate ");                     
                    var PartsDetails=PartsDetails.replace("$(containerId).swhgLoad($(this).attr('href'), containerId, callback);"," if( !($(this).parent('li').hasClass('disabled')) ) { $(containerId).swhgLoad($(this).attr('href'), containerId, callback);}");
                    $('#divParts').html(PartsDetails);  
                    }      
         });
         AfterLoad();
    </script>
}
<script>
    $(document).on('keydown', '.addQuantityinGrid', function (e) {
-1 !== $.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) || /65|67|86|88/.test(e.keyCode) && (!0 === e.ctrlKey || !0 === e.metaKey) || 35 <= e.keyCode && 40 >= e.keyCode || (e.shiftKey || 48 > e.keyCode || 57 < e.keyCode) && (96 > e.keyCode || 105 < e.keyCode) && e.preventDefault()
        if (this.value.length >= 6 && e.keyCode != 8) ///Ignore BackSpace Key
        {
            // $(this).next("span").html("Maximum allowed limit is 6").attr("style", "color:red !important ").show().fadeToggle("slow");
            $(this).next("span").html("@Resources.Resource.MsgInfo22").attr("style", "color:red !important ").show().fadeToggle("slow");
            e.preventDefault()
            return false;
        }
    });
    $(document).on('keydown', '.addPartsinGrid', function (e) {
        if (this.value.length >= 20 && e.keyCode != 8) ///Ignore Backspace
        {
            // $(this).next("span").html("Maximum allowed limit is 20").attr("style", "color:red !important ").show().fadeToggle("slow");
            $(this).next("span").html("@Resources.Resource.MsgInfo23").attr("style", "color:red !important ").show().fadeToggle("slow");
            e.preventDefault()
            return false;
        }
    });
</script>
<script type="text/javascript">
    $(document).on("change", "#chkSelectAll", function () {///hst006
        if (this.checked) {
            $('#StockTransferDetailsGrid> tbody>tr').each(function () {
                if (!$(this).hasClass("NewPartsRow") && !$(this).hasClass("trBtnAddNewParts")) {
                    $(this).addClass('highlight');
                }
            });
            $("#btnDelete").removeAttr("disabled");
        }
        else {
            $('#StockTransferDetailsGrid> tbody>tr').each(function () {
                if (!$(this).hasClass("NewPartsRow") && !$(this).hasClass("trBtnAddNewParts")) {
                    $(this).removeClass('highlight');
                }
            });
            $("#btnDelete").attr("disabled", true);
        }
        //Shabbir Start
        if (this.checked) 
        {
           AddItemsForSelectAll(data); 
        }
        else
        {
            RemoveItemsForSelectAll();
        }
        //Shabbir End


    });
    //Shabbir Start
    function AddItemsForSelectAll(data) 
    {
        for (var i = 0; i < data.length; i++) 
        {
            if(!isItemInArray(gselectedList, [$.trim(data[i].LineNo), $.trim(data[i].SubLine_No)]))
            {
                gselectedList.push([$.trim(data[i].LineNo), $.trim(data[i].SubLine_No)]);
            }
        }
    }

    function RemoveItemsForSelectAll() 
    {
        gselectedList = [];
    }
    //Shabbir End
</script>
<script type="text/javascript">
    $(document).on('click', '#btnOk', function () {
        $("#MessageModal").modal('hide');
    }); 
      $("#btnCondition").click(function () {
	  if ($.trim($("#txtTransferQuoteNo").val()) == "")
	   { 
		 //txtError = "Please Enter Quotation No";
	     txtError ="@Resources.Resource.MsgInfo51";
		 txtErrorType = "0";
		 DisplayModal(txtErrorType, txtError);  
		/* $("#spnQuotation").html("*").attr("style", "color: red;  ");*/
	   	$("#txtTransferQuoteNo").attr("style","border-color:#ff8080 !important;box-shadow: 0px 0px 5px 0px #ff8080; ");
	    return;
		}
		 url= "@Url.Action( "StockReqConditionView","STCondition")";
		 var curl=url+"?QuoteNo="+$("#txtTransferQuoteNo").val();
		  window.location.href=curl;
		})//click end
</script>
